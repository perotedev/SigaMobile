#!/bin/bash
INIT="\e[01;33mIniciando Containers\e[00m üîñ\n"
START="\e[01;33mInciando aplica√ß√£o em\e[00m"
APP_PORT="\e[01;36m http://localhost:4040\e[00m üí°"
STOP_INIT="\e[01;33mParando Containers\e[00m ü•µ\n"
STOP_FINISH="\e[01;36mA aplica√ß√£o foi encerrada\e[00m ü•±"
COMMAND="\e[01;33m'$1'\e[00m"
COMMAND_START="\e[01;36mstart\e[00m"
COMMAND_STOP="\e[01;36mstop\e[00m"
ERROR="Comando $COMMAND n√£o √© v√°lido, tente novamente ‚ùå"
HELP_COMMANDS="Comandos v√°lidos: $COMMAND_START e $COMMAND_STOP ‚úÖ"
STATUS=$(curl -s http://localhost:4040)
ALREADY_START="\e[01;33mA aplica√ß√£o j√° est√° em execu√ß√£o\e[00m ü§®"

if [ $1 == "start" ]
then
    # Verifica se a aplica√ß√£o j√° est√° sendo executada
    if [ "$STATUS" == "This server is running in port 4040" ]
    then
        echo -e "\n$ALREADY_START\n"
    else
        # Inicializa os containers
        echo -e "\n$INIT"
        docker-compose start

        # Inicia a aplica√ß√£o
        echo -e "\n$START $APP_PORT"
        sleep 2
        docker-compose exec -T siga-server /bin/bash -c \ "cd /home/node/app && npm run start:dev"
    fi
else
    if [ $1 == "stop" ]
    then
        # Parando os containers
        echo -e "\n$STOP_INIT"
        docker-compose stop
        echo -e "\n$STOP_FINISH\n"
    else
        echo -e "\n$ERROR\n$HELP_COMMANDS"
    fi
fi


